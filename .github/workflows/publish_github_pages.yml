name: Publish Github Pages

on:
  push:
    branchs:
      - master

jobs:
  publish:
    runs-on: ubuntu-18.04
    steps:
      - uses: actions/checkout@v2
      #- uses: ./
      #  with:
      #    source: README.adoc
      #  env:
      #    DEPLOY_TOKEN: ${{secrets.DEPLOY_TOKEN}}
      - name: Build and Publish
        run: |
          docker run -v $(pwd):/asciibook asciibook/asciibook asciibook build README.adoc --format html
          sudo chown ${whoami} build
          cd build/html
          touch .nojekyll

          git init
          git config user.name "${GITHUB_ACTOR}"
          git config user.email "${GITHUB_ACTOR}@users.noreply.github.com"
          git add .
          git commit -m 'asciibook build'
          git push --force https://x-access-token:${DEPLOY_TOKEN}@github.com/${GITHUB_REPOSITORY}.git master:gh-pages
          rm -fr .git
          cd ../..
        env:
          DEPLOY_TOKEN: ${{secrets.DEPLOY_TOKEN}}
